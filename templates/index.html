<!DOCTYPE html>
<html>

<head>
   <title>Home</title>
</head>

<body>
   <head>
      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.css">
      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.6.5/css/buttons.dataTables.min.css">
      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/fixedcolumns/3.3.3/css/fixedColumns.dataTables.min.css">
      <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
      <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
      <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/fixedcolumns/3.3.3/js/dataTables.fixedColumns.min.js"></script>
      <script>
         $(document).ready(function () {
            var image = function (data, type, row) {
               return '<img src="https://securea.mlb.com/mlb/images/players/head_shot/' + data + '.jpg" width="40"/>'
            }
            var percentFunc = function (data, type, row) {
               if (data === '') {
                  return data;
               } else {
                  return (data * 100).toFixed(2).toString() + '%';
               }
            }
            var roundFunc = function (data, type, row) {
               if (data === '') {
                  return data;
               } else {
                  return data.toFixed(2).toString();
               }
            }
            var batterLinkFunc = function (data, type, row) {
               return '<a href="https://www.mlb.com/player/' + row.player_id + '" target="_blank">' + data + '</a>';
            }
            var pitcherLinkFunc = function (data, type, row) {
               return '<a href="https://www.mlb.com/player/' + row.pitcher_id + '" target="_blank">' + data + '</a>';
            }
            var gameLinkFunc = function (data, type, row) {
               return '<a href="https://www.mlb.com/gameday/' + row.game_pk + '" target="_blank">' + data + '</a>';
            }
            var last_x_days = 7;
            $('table.display').DataTable({
               ajax: {
                  url: '/loadTableData?days=' + last_x_days,
                  dataSrc: ''
               },
               columns: [
                  {
                     data: 'player_name',
                     title: 'Name',
                     render: batterLinkFunc
                  }, {
                     data: 'team',
                     title: 'Team'
                  }, {
                     data: 'batter_handedness',
                     title: 'B'
                  }, {
                     data: 'H_total',
                     title: 'H'
                  }, {
                     data: 'xH_per_G_total',
                     title: 'xH per Game',
                     render: roundFunc
                  }, {
                     data: 'hit_pct_total',
                     title: '% of Games w/ Hit',
                     render: percentFunc
                  }, {
                     data: 'x_hit_pct_total',
                     title: 'Expected % of Games w/ Hit',
                     render: percentFunc
                  }, {
                     data: 'H_' + last_x_days,
                     title: 'H (last ' + last_x_days + ' days)'
                  }, {
                     data: 'xH_per_G_' + last_x_days,
                     title: 'xH per Game (last ' + last_x_days + ' days)',
                     render: roundFunc
                  }, {
                     data: 'hit_pct_' + last_x_days,
                     title: '% of Games w/ Hit (last ' + last_x_days + ' days)',
                     render: percentFunc
                  }, {
                     data: 'x_hit_pct_' + last_x_days,
                     title: 'Expected % of Games w/ Hit (last ' + last_x_days + ' days)',
                     render: percentFunc
                  }, {
                     data: 'opponent',
                     title: 'Opponent',
                     render: gameLinkFunc
                  }, {
                     data: 'pitcher_name',
                     title: 'Probable Opposing Starter',
                     render: pitcherLinkFunc
                  }, {
                     data: 'sp_xHA_per_BF_interval',
                     title: 'Starter: xHA per Batter (Q1, Q2, Q3)'
                  }, {
                     data: 'bp_xHA_per_BF_interval',
                     title: 'Bullpen: xHA per Batter (Q1, Q2, Q3)'
                  }
               ],
               order: [[ 3, 'desc']],
               scrollX: true,
               paging: false,
               scrollY: '75vh',
               scrollCollapse: true,
               fixedColumns: {
                  leftColumns: 3
               }
            })
         });
      </script>
   </head>
   <table class="display"></table>
</body>

</html>